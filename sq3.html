<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Document</title>
		<style>
			.objects {
				max-width: 100px;
				max-height: 100px;
			}
			.objects:hover {
				cursor: pointer;
				z-index: 1000;
				filter: contrast(150%);
			}
			* {
				box-sizing: border-box;
			}

			.scoreboard {
				text-transform: uppercase;
				font-size: 2em;
				text-align: center;
				background-color: rgb(4, 74, 213);
				color: white;
				padding: 10px;
			}
			.btn {
				display: block;
				padding: 10px;
				margin: 10px auto;
				width: 25%;
				font-size: 2em;
			}
			.gridContainer {
				display: grid;
			}
		</style>
	</head>
	<body>
		<div class="gameArea"></div>
		<script>
			const gameArea = document.querySelector(".gameArea");
			document.addEventListener("DOMContentLoaded", init);
			let flag = false;
			// let step = 0;
			// let scores = 0;
			let gameLife = 3;
			// let inPlay;
			const game = {
				// arr: [],
				animation: {},
				inPlay: false,
				gameBtn: {},
				scores: 0,
				step: 0,
			};

			function init() {
				gameArea.innerHTML = "";
				const temp = `Ваш счет: ${game.scores} очков. `;
				game.scoreBoard = createNewElement(gameArea, "div", temp, "scoreboard");
				game.gameBtn = createNewElement(gameArea, "button", "Start", "btn");
				game.gameBtn.addEventListener("click", () => {
					if (game.gameBtn.textContent == "Start") {
						game.inPlay = true;
						game.animation = requestAnimationFrame(startGame);
						game.gameBtn.textContent = "Stop";
					} else {
						cancelAnimationFrame(game.animation);
						game.gameBtn.textContent = "Start";
						game.inPlay = false;
					}
				});
				const main = createNewElement(gameArea, "div", "", "gridContainer");
				buildGrid(main);
			}

			//Готово:  массив игровых объектов
			let objects = [
				"img/obj_round_blue.png",
				"img/obj_round_green.png",
				"img/obj_round_red.png",
				"img/obj_round_yellow.png",
				"img/obj_round_orange.png",
				"img/obj_square_blue.png",
				"img/obj_square_green.png",
				"img/obj_square_red.png",
				"img/o bj_square_yellow.png",
				"img/obj_square_orange.png",
				"img/obj_trian_blue.png",
				"img/obj_trian_green.png",
				"img/obj_trian_red.png",
				"img/o bj_trian_yellow.png",
				"img/obj_trian_orange.png",
			];

			// obj_round_blue("img/obj_round_blue.png"),
			// obj_round_green("img/obj_round_green.png"),
			// obj_round_red("img/obj_round_red.png"),
			// obj_round_yellow("img/o bj_round_yellow.png"),
			// obj_round_orange("img/obj_round_orange.png"),
			// obj_square_blue("img/obj_square_blue.png"),
			// obj_square_green("img/obj_square_green.png"),
			// obj_square_red("img/obj_square_red.png"),
			// obj_square_yellow("img/o bj_square_yellow.png"),
			// obj_square_orange("img/obj_square_orange.png"),
			// obj_trian_blue("img/obj_trian_blue.png"),
			// obj_trian_green("img/obj_trian_green.png"),
			// obj_trian_red("img/obj_trian_red.png"),
			// obj_trian_yellow("img/o bj_trian_yellow.png"),
			// obj_trian_orange("img/obj_trian_orange.png"),

			//Готово:  рандом из игровых объектов
			let randomObject;
			randomObject = objects[Math.floor(getRandom(0, objects.length))];
			console.log(randomObject);

			//Готово:  рандом движения по экрану
			let startPoint;
			startPoint = Math.floor(getRandom(0, window.innerWidth));
			console.log(startPoint);

			// движение полета объектов
			function startGame() {
				if (game.inPlay) {
					flag = true;
					//Двигаем сверху вниз (перепроверить!!! и надо ли убивать обект? может спрятать?)
					if (gameArea.Height + 50 > 0 && flag) {
						let left = startPoint + "px";
						randomObject.style.top = "0px";
						randomObject.style.left = left;
						randomObject.style.transform = "scaleY(1)";
						randomObject.hidden = false;
						step += 1;
					} else {
						// добавляем в массив еще объекты
						objects.push(randomObject);

						// console.log(objects);
						flag = false;
						// this.randomObject.hidden = true;
					}
					this.randomObject.style.top = step + "px";
					animation = requestAnimationFrame(startGame);
					hideSquare();
					wrongClick();
					updateScore();
				}
			}
			// setInterval(animation, 1);

			// убиваем использованные объекты
			// let hasDead = false;
			// for (let i = 0; i < objects.length; i++) {
			// 	objects[i].Update();
			// 	if (objects[i].dead) {
			// 		hasDead = true;
			// 	}
			// }

			// if (hasDead) {
			// 	objects.shift(); тут вопрос, так как убивать первый эелмент нет смысла, используется же что-то рандомное.... может просто убивать все элементы из массива? а потом пушить их заново?
			// }

			// функция нажатия на квадрат и его исчезновения
			// Проверить!!!
			function hideSquare() {
				let square;
				gameArea.innerHTML += `<img src="/img/obj_square${square}.png" onclick="this.style.display = 'none'"> `;
				// square.hidden = true;
				// square.style.display = "none";
				game.scores = game.scores + 1;
			}
			// ДОПИСАТЬ!!! Обновление счета
			function updateScore() {
				const temp = `Ваш счет: ${game.scores} очков!`;
				game.scoreBoard.textContent = temp;
			}
			// Проверить!!! если игрок нажимает не на квадрат, объект исчезант и минус 1 жизнь
			function wrongClick() {
				let round;
				let triangle;
				gameArea.innerHTML += `<img src="/img/obj_round${round}.png" onclick="this.style.display = 'none'">`;
				gameArea.innerHTML += `<img src="/img/obj_trian${triangle}.png" onclick="this.style.display = 'none'">`;
				if (gameLife > 0) {
					gameLife = gameLife - 1;
					alert("Упс! Вы промахнулись! -1 жизнь...");
				} else {
					alert("Вы проиграли!");
				}
			}

			// ДОПИСАТЬ!!! вывод жизней на экран

			// Готово: функция рандома
			function getRandom(min, max) {
				return Math.random() * (max - min) + min;
			}
		</script>
	</body>
</html>
